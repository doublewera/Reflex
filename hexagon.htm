<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Reflex: формат описания графического файла</title>
</head>
<body>
<p>Структура документа :</p>
<pre>&lt;<b>picture</b> class="" style="" format=""&gt;
	&lt;<b>grid</b> class="" style="" type="" offset=""&gt;
		&lt;<b>axis</b> name="" type="" direction="" min="" max="" major="" minor="" skip="" /&gt;
		&lt;<b>graphic</b> title="" pen="" (x/y/z/r/phi/psi)="" color="" /&gt;
	&lt;/<b>grid</b>&gt;
	&lt;<b>legend</b> class="" style="" rows="" columns=""&gt;
		&lt;<b>label</b> class="" style="" text="" /&gt;
	&lt;/<b>legend</b>&gt;
	&lt;<b>label</b> class="" style="" text="" /&gt;
	&lt;<b>data</b> type=""&gt;
		&lt;<b>head</b>&gt;
			Hat1	Hat2	Hat3 ...
		&lt;/<b>head</b>&gt;
		&lt;<b>table</b> splitter=""&gt;
			The_table_itself
		&lt;/<b>table</b>&gt;
	&lt;/<b>data</b>&gt;
&lt;/<b>picture</b>&gt;
</pre>
<p>Если атрибут имеет недопустимое значение, значение выбирается автоматически. В данном документе везде, где предлагается выбрать 
значение из списка, первым номером указано автоматическое (значение по умолчанию).</p>
<h3>________Семантика и прагматика атрибутов________</h3>
<p>Сlass и style служат для обращения к таблицам стилей.</p>
<h4>Атрибуты picture</h4>
<p>format в picture задает формат файла выводимого изображения. Поддерживаемые форматы:</p>
<ul><li>PNG
</li><li>BMP
</li><li>JPEG
</li><li>SVG
</li></ul>
<h4>Атрибуты grid</h4>
<p>type в grid выбирает структуру сетки и принимает одно из следующих значений:</p>
<ul><li>cartesian2d
</li><li>cartesian3d
</li><li>polar
</li><li>cylindrical
</li><li>spherical
</li></ul>
<p>offset задает смещение начала координат сетки от левого нижнего угла участка картинки, выделенного под эту сетку, в виде 
x;y[;z]. Третья компонента - только для объемных сеток. Значение может быть указано в пикселях либо процентах (от размера сетки).
По умолчанию смещение для сферической и полярной сеток устанавливается 50%;50% (центр), а для остальных вычисляется с учетом 
размера шрифта и длин осей (атрибут direction).</p>
<p>Grid содержит не меньше двух и не больше трех осей.</p>
<h4>Атрибуты axis</h4>
<p>name может принимать одно из шести значений: x,y,z,r,phi,psi. Двух осей с одинаковыми именами не бывает.
(Это похоже на атрибут isPolar в qlook). На имена осей ссылаются формулы.</p>
<p>type оси - это тип, к которому программа будет приводить те данные из колонок, которые в координатах графика будут ассоциированы с 
этой осью. Пока поддерживается два встроеных типа: double и datetime</p>
<p>direction - это описание конца оси в векторной форме (начало в начале координат)</p>
<p>min, max - это минимальное и максимально значение, которое принимают данные, за отображение которых
отвечает эта ось. Записываются в том же формате, что и сами данные. Могут быть определены программой автоматически.</p>
<p>major, minor - количество основных и промежуточных линий сетки на оси.</p>
<p>skip - величина, отвечающая за корректировку ошибок специального рода, а именно:</p>
<ul><li>skip="0" - не искать ошибок
</li><li>skip="X", x&lt;0 - не рисовать, если разность между значениями в предыдущей и последующей точках меньше X
</li><li>skip="X", x&gt;0 - не рисовать, если разность между значениями в предыдущей и последующей точках больше X
</li></ul>
<h4>Атрибуты graphic</h4>
<p>pen - SVG-изображение, "которым" рисуется линия или собирается паркет</p>
<p>x,y,z,r,phi,psi - атрибуты, наличие которых зависит от количества осей.
<p> Возможны только такие сочетания:</p>
<ul><li>(x,y)
</li><li>(x,y,z)
</li><li>(r,phi)
</li><li>(r,phi,z)
</li><li>(r,phi,psi)
</li></ul>
<p> - по одному сочетанию на тип сетки соответственно.</p>

<p> График может представлять
собой непрерывную (ломаную или сплайн) линию, разрывную (из отрезков) или
множество точек. В любом случае ключевые точки берутся из таблицы и могут быть
примитивно обработаны математически. Для более сложной обработки перед рисованием
рекомендуется воспользоваться специализированной программой.</p>

<p>Каждому такому атрибуту присваивается значение в виде формулы, в которую
могут входить имена колонок и их комбинаций ("$colNameCombination$"),
а также константы и математические операторы (функции).
ПРИДУМАТЬ СПОСОБ ВВОДА ЗНАКА $\| В ИМЯ КОЛОНКИ.</p>

<p>На каждом шаге отрисовки считываются значения из колонок в текущей
просматриваемой строке и подставляется вместо имени этих колонок
(заменяется комбинация: знак доллара+имя+пробел(или группа пробелов));
затем происходят три преобразования в следующем порядке:
</p>
<ol><li> <b>Синтаксическое преобразование.</b> Например, три колонки содержат часы,
 минуты и секунды некоторого момента времени. Вставив между ними двоеточия, мы объединяем
колонки в одну. Такое преобразование происходит автоматически (в момент подстановки).
В случае отсутствия необходимой колонки в файле программа подставит вместо ее имени ноль
в процессе вычислений. (ЧТО, И ПРИ УМНОЖЕНИИ ТОЖЕ?)
</li><li> <b>Форматное преобразование.</b> Полученная на предыдущем шаге строка
представляет собой формулу из подобий чисел, которые теперь требуется распознать. На данном этапе
поддерживается два формата - вещественное число и дата-время. Во втором случае возможны
варианты разделителей и порядка чисел в записи.
</li><li> <b>Математическая часть.</b> Непосредственно вычисления. К этому моменту числа уже
прочитаны и "распарсены".
</li></ol>

<p>В соответствии с выбранным режимом, рисуется точка, или линия, соединяющая с
предыдущей точкой.</p>

<p>color - цвет линии (если не предусмотрена картинка в атрибуте pen).</p>
<h4>Атрибуты legend</h4>
<p>rows - количество строк в таблице легенды</p>
<p>columns - количество столбцов таблицы в легенде</p>
<h4>Атрибуты label</h4>
<p>text - Строка. Ярлык бывает не только текстовым, но остальные его свойства спрятаны в соответствующие параметры CSS</p>
<h4>Атрибуты data</h4>
<p>type - тип данных. Поддерживаются следующие типы: table, sql-request, file(s)</p>
<h4>Аттрибуты table</h4>
<p>splitter - Набор символов (любой), которым разделяются колонки. Например: пробел (или пустая строка, трактующаяся, как любой 
пробельный символ), ;, |, или даже &lt;/td&gt;&lt;td&gt;</p>
<p>Следует отметить, что table может отсутствовать.</p>
<h3>________Таблица стилей________</h3>

<table width="100%">
 <thead>
  <tr>
   <th>picture</th>
   <th>grid</th>
   <th>legend</th>
   <th>label</th>
  </tr>
 </thead>
 <tbody>
  <tr valign="top">
   <td>
    width:<br>
    height:<br>
    background-color:<br>
	<hr />
    background-image:<br>
    background-position:<br>
    background-repeat:<br>
    border-width:<br>
    border-style:<br>
    border-color:<br>
   </td>
   <td>
    top:<br>
    left:<br>
    width:<br>
    height:<br>
    opacity:<br>
    color:<br>
    background-color:<br>
	<hr />
    border-width:<br>
    border-style:<br>
    border-color:<br>
    line-height:<br>
<!--    arrow-type:<br> -->
    text-align:<br>
    text-decoration:<br>
    z-index:<br>
   </td>
   <td>
    top:<br>
    left:<br>
    width:<br>
    height:<br>
    background-color:<br>
	<hr />
    border-width:<br>
    border-style:<br>
    border-color:<br>
    padding:<br>
    color:<br>
    line-height:<br>
    text-align:<br>
    text-decoration:<br>
    opacity:<br>
    z-index:<br>
   </td>
   <td>
    top:<br>
    left:<br>
    background-color:<br>
    background-image:<br>
    color:<br>
	<hr />
    width:<br>
    height:<br>
    padding:<br>
    opacity:<br>
    background-position:<br>
    background-repeat:<br>
    border-width:<br>
    border-style:<br>
    border-color:<br>
    font-family:<br>
    font-size:<br>
    font-style:<br>
    font-variant:<br>
    font-weight:<br>
    z-index:<br>
   </td>
  </tr>
 </tbody>
</table>

<h4>Правила записи формул:</h4>

<ul><li> Все синтаксические преобразования происходят между парами знаков "|".
	Это позволяет отделять "-" в синтаксисе и знак вычитания и др.
</li><li> Поддерживаемые символы для синтаксических конкатенаций столбцов:
	<ul><li> +-.eE (позволяют преобразовать несколько столбцов целых чисел
			в одно число с плавающей точкой)
	</li><li> :-TZW (позволяют преобразовывать несколько столбцов целых чисел
			и столбцов даты-времени в дата-время)
	</li></ul>
<p>В силу того, что других форматов данных у нас пока нет, и способа задания
своего формата (со своим синтаксисом) тоже пока нет, вводимые символы должны корректно
соответствовать стандартам этих двух форматов - float, datetime ( см. грамматику ниже
<!-- a href="http://ru.wikipedia.org/wiki/Числа_с_плавающей_запятой">число с плавающей точкой</a>, 
<a href="http://ru.wikipedia.org/wiki/ISO_8601">ISO 8601 (дата и время)</a-->)
.</p>
</li><li>Поддерживаемые функции и константы:
</li><li>Формулы пишутся в формате tex.
</li><li>Перед именными функциями ОБЯЗАТЕЛЕН "\".
</li><li>Поддерживаемые функции и константы:
	<ol><li> +- (как бинарные, так и унарные),
	</li><li> * (умножение),
	</li><li> ^ (возведение в степень), 
	</li><li> / ("обычное" деление),
	</li><li> : (деление нацело),
	</li><li> % (взятие остатка от деления)
	</li><li> \ln, \lb, \lg, \log_{b}{a} (логарифм а по основанию b. Скобки пока обязательны. <!-- необязательны, но тогда 
основание должно 
содержать не более одного символа в записи -->)
	<!-- /li><li> \sin, \cos, \tg, \ctg, \asin, \acos, \atan, \actg
	</li><li> \e = 2,718..., \pi = 3.1415..., \h = , \c = 3e8, \Re = 6400 km
	</li><li --> 
	</li></ol>
<p>{5}, {6} можно использовать даже для чисел с плавающей запятой.</p>
</li></ul>

<h4>Грамматика поддерживаемых выражений</h4>

<pre>
formula ::= &lt;const&gt;
	| "|" &lt;columnCombination&gt; "|"
	| "(" &lt;formula&gt; ")"
	| &lt;mathFunc&gt; "{" &lt;formula&gt; "}"
	| &lt;formula&gt; &lt;mathOp&gt; &lt;formula&gt;

cn ::= &lt;const&gt;
	| "$" &lt;columnName&gt; "$"
columnCombination ::= &lt;cn&gt;
		| ( &lt;cn&gt; )? "." ( &lt;cn&gt; )? ( ( "e"|"E" ) &lt;cn&gt; )?
		| &lt;dateCombination&gt;
		| &lt;timeCombination&gt; ( &lt;timeZone&gt; )?
		| &lt;dateCombination&gt; "T" &lt;timeCombination&gt; ( &lt;timeZone&gt; )?

dateCombination ::= &lt;cn&gt; ( "-" &lt;cn&gt; ( "-" &lt;cn&gt; )? )?
		| &lt;cn&gt; ( &lt;cn&gt; ( &lt;cn&gt; )? )?

timeCombination ::= &lt;cn&gt; ( ":" &lt;cn&gt; ( ":" &lt;cn&gt; )? )?
		| &lt;cn&gt; ( &lt;cn&gt; ( &lt;cn&gt; )? )?
hhmm ::= &lt;cn&gt; ( ":" &lt;cn&gt; )?
	| &lt;cn&gt; ( &lt;cn&gt; )?
timeZone ::= "Z" | ("+" | "-") &lt;hhmm&gt;

mathFunc ::=	  "\ln"
		| "\lb"
		| "\lg"
		| "\log_{" &lt;formula&gt; "}"

const ::= &lt;float&gt; | &lt;integer&gt; | "\e" | "\pi" | "\h" | "\c" | "\Re"
float ::= ( &lt;integer&gt; )? "." ( &lt;integer&gt; )? ( ( "e"|"E" ) &lt;integer&gt; )?
integer ::= ("+"|"-")?("0"-"9")+

plusOrMinus ::= "+"
		| "-"
mathOp ::= &lt;plusOrMinus&gt;
		| "*"
		| "^"
		| "/"
		| ":"
		| "%"

specSymbol ::= "."#  +-.eE :-TZW
</pre>

<table border="1" cellspacing="0">
<thead><tr><th colspan="2">В грамматике использованы следующие символы:</th></tr></thead>
<tbody>
<tr><td>::=</td><td>"это есть"</td></tr>
<tr><td>&lt;...&gt;</td><td>внутри - выражение, для которого грамматика содержит определение</td></tr>
<tr><td>|</td><td>разделяет альтернативные варианты из которых выбирается один</td></tr>
<tr><td>(...)?</td><td>выражение, содержащиеся внутри может быть опущено</td></tr>
<tr><td>(...)+</td><td>выражение, содержащиеся внутри НЕ может быть опущено и может повториться неограниченное количество 
раз</td></tr>
<tr><td>(a)*</td><td>((...)?)+</td></tr>
<tr><td>(...){N-M, K}</td><td>Выражение из круглых скобок повторяется от N до M раз или K раз</td></tr>
<tr><td>...-...</td><td>Любой символ из заданного интервала</td></tr>
<tr><td>"..."</td><td>Символ в кавычках используется как таковой</td></tr>
</tbody>
</table>

</body>
</html>
